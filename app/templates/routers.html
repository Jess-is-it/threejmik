{% extends "base.html" %}
{% block content %}
<div class="page-header d-print-none">
  <div class="row align-items-center">
    <div class="col">
      <h2 class="page-title">Routers</h2>
      <div class="text-secondary">Manage RouterOS devices and schedules.</div>
    </div>
  </div>
</div>
<ul class="nav nav-tabs mb-3" data-bs-toggle="tabs">
  <li class="nav-item">
    <a href="#tab-add" class="nav-link active" data-bs-toggle="tab">Add Router</a>
  </li>
  <li class="nav-item">
    <a href="#tab-presets" class="nav-link" data-bs-toggle="tab">Router Presets</a>
  </li>
</ul>
<div class="tab-content">
  <div class="tab-pane active show" id="tab-add">
    <form method="post" action="/routers">
      <div class="card">
        <div class="card-header"><h3 class="card-title">Add Router</h3></div>
        <div class="table-responsive">
          <table class="table card-table table-vcenter">
            <thead>
              <tr>
                <th>Router Name</th>
                <th>IP</th>
                <th>API Port</th>
                <th>API Timeout</th>
                <th>Username</th>
                <th>Password</th>
                <th>FTP Port</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><input class="form-control" name="name" required></td>
                <td><input class="form-control" name="ip" required></td>
                <td><input class="form-control" type="number" name="api_port" value="8728"></td>
                <td><input class="form-control" type="number" name="api_timeout_seconds" value="5" min="1"></td>
                <td><input class="form-control" name="username" required></td>
                <td><input class="form-control" name="password" type="password" required></td>
                <td><input class="form-control" type="number" name="ftp_port" value="21" min="1"></td>
                <td>
                  <button class="btn btn-outline-primary btn-sm" type="submit" formmethod="post" formaction="/routers/test-draft" formnovalidate>Test API</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <input type="hidden" name="enabled" value="1">
        <div class="card-footer text-end">
          <button class="btn btn-primary" type="submit">Create Router</button>
        </div>
      </div>
    </form>
  </div>
  <div class="tab-pane" id="tab-presets">
    <form method="post" action="/routers/presets">
      <div class="card">
        <div class="card-header"><h3 class="card-title">Router Presets</h3></div>
        <div class="table-responsive">
          <table class="table card-table table-vcenter">
            <thead>
              <tr>
                <th>Router</th>
                <th>Retention Days</th>
                <th>Backup Check Interval</th>
                <th>Daily Baseline Time</th>
                <th>Force Backup Every</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for router in routers %}
              <tr>
                <td>
                  <div class="fw-bold"><a href="/routers/{{ router.id }}">{{ router.name }}</a></div>
                  <input type="hidden" name="router_id_{{ router.id }}" value="{{ router.id }}">
                </td>
                <td><input class="form-control" type="number" name="retention_days_{{ router.id }}" value="{{ router.retention_days }}" min="1"></td>
                <td><input class="form-control" type="number" name="backup_check_interval_hours_{{ router.id }}" value="{{ router.backup_check_interval_hours }}" min="1"></td>
                <td><input class="form-control" name="daily_baseline_time_{{ router.id }}" value="{{ router.daily_baseline_time }}" placeholder="HH:MM"></td>
                <td><input class="form-control" type="number" name="force_backup_every_days_{{ router.id }}" value="{{ router.force_backup_every_days }}" min="1"></td>
                <td>
                  <label class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="enabled_{{ router.id }}" value="1" {% if router.enabled %}checked{% endif %}>
                    <span class="form-check-label">Enable</span>
                  </label>
                  <label class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="enabled_{{ router.id }}" value="0" {% if not router.enabled %}checked{% endif %}>
                    <span class="form-check-label">Disable</span>
                  </label>
                </td>
                <td>
                  <button class="btn btn-outline-primary btn-sm" type="submit" formmethod="post" formaction="/routers/{{ router.id }}/test" formnovalidate>Test API</button>
                </td>
              </tr>
              {% else %}
              <tr>
                <td colspan="7" class="text-secondary">Please add router first.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <div class="card-footer text-end">
          <button class="btn btn-primary" type="submit">Save Presets</button>
        </div>
      </div>
    </form>
  </div>
</div>
{% endblock %}

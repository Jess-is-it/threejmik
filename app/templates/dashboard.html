{% extends "base.html" %}
{% block content %}
<div class="page-header d-print-none">
  <div class="row align-items-center">
    <div class="col">
      <h2 class="page-title">Router Status</h2>
      <div class="text-secondary">Latest health, backups, and change signals.</div>
    </div>
  </div>
</div>
<div class="card">
  <div class="table-responsive">
    <table class="table card-table table-vcenter">
      <thead>
        <tr>
          <th>Router</th>
          <th>Last Backup</th>
          <th>Last Success</th>
          <th>Last Error</th>
          <th>Last Change</th>
          <th>Links</th>
        </tr>
      </thead>
      <tbody>
        {% for router in routers %}
        {% set links = parse_links(router.last_backup_links) %}
        <tr>
          <td><a href="/routers/{{ router.id }}">{{ router.name }}</a></td>
          <td>{{ format_ts(router.last_backup_at) }}</td>
          <td>
            {{ format_ts(router.last_success_at) }}
            {% if is_stale(router.last_success_at) %}
            <span class="badge bg-red">Stale</span>
            {% endif %}
          </td>
          <td>{{ router.last_error if router.last_error else "-" }}</td>
          <td>{{ format_ts(router.last_config_change_at) }}</td>
          <td>
            {% if links.backup %}<a href="{{ links.backup }}">.backup</a>{% endif %}
            {% if links.rsc %}<a href="{{ links.rsc }}">.rsc</a>{% endif %}
            {% if not links.backup and not links.rsc %}-{% endif %}
          </td>
        </tr>
        {% else %}
        <tr><td colspan="6" class="text-secondary">No routers registered yet.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
